<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Let's create an avatar !</title>
<style>
        body {
            background-image: url('https://static.vecteezy.com/system/resources/thumbnails/006/691/884/small/blue-question-mark-background-with-text-space-quiz-symbol-vector.jpg');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            color: white;
            font-family: Georgia, serif;
            font-size: 20px;
            padding: 20px;
        }
 
        input[type="text"], button {
            border-radius: 10px;
            border: 2px solid green;
            padding: 5px 10px;
            margin-bottom: 10px;
        }
 
        button {
            background-color: green;
            color: white;
            display: none; 
        }
 
        .error-message {
            color: red;
        }
 
        .success-message {
            color: green;
        }
 
       
 
    </style>
<!-- jQuery -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>
<body>
<div id="notificationDiv" class="alert alert-danger d-none" role="alert">
<!-- Message will be inserted here -->
</div>
<div id="successMessage" class="alert alert-success d-none">
<!-- Success message will be inserted here -->
</div>
<h1>Create your profile</h1>
<form action="ConnectShowed" method="post">
<label for="username">Username: </label>
<input type="text" name="username" id="username" />
<button type="submit" id="connectButton">Connect</button>
<input type="hidden" id="sessionId" name="sessionId" value="" />
</form>
 
    @section Scripts {
<script>
            $(document).ready(function () {
                // Function to validate username input
                function validateUsername(input) {
                    var value = $(input).val().trim();
                    var message = '';
                    if (value === '') {
                        message = 'Username is required.';
                    }
                    return message;
                }
 
                // Function to check form validity
                function checkFormValidity() {
                    var errorMessage = validateUsername($('#username'));
                    if (errorMessage !== '') {
                        $('#notificationDiv').text(errorMessage).removeClass('d-none');
                        $('#successMessage').addClass('d-none').text(''); 
                        $('#connectButton').hide(); 
                    } else {
                        $('#notificationDiv').addClass('d-none').text('');
                        return true;
                    }
                }


                $('#connectButton').click(function (event) {
                    event.preventDefault(); // Empêche le formulaire d'être soumis normalement

                    var username = $('#username').val().trim();
                    var session_id = $('#sessionId').val(); // Assurez-vous de remplir ce champ avec l'ID de session approprié avant d'envoyer la requête AJAX

                    $.ajax({
                        url: '/userQuizzes/ConnectShowed',
                        type: 'POST',
                        data: { username: username, sessionId: session_id },
                        success: function (response) {
                            // Gérer la réponse (par exemple, afficher un message de succès)
                            console.log(response);
                        },
                        error: function (xhr, status, error) {
                            console.error("Une erreur est survenue : " + error);
                        }
                    });
                });

 
                $('#username').blur(function () {
                    var username = $(this).val().trim();
                    if (username !== '') {
                        $.ajax({
                            url: '/userQuizzes/verifyUsername',
                            type: 'GET',
                            data: { username: username },
                            success: function (response) {
                                if (response.exists) {
                                    $('#notificationDiv').text('Username is already taken.').removeClass('d-none');
                                    $('#successMessage').addClass('d-none').text('');
                                    $('#connectButton').hide(); 
                                } else {
                                    $('#notificationDiv').addClass('d-none').text('');
                                    $('#successMessage').text('Username is available.').removeClass('d-none');
                                    $('#connectButton').show(); 
                                }
                            },
                            error: function (xhr, status, error) {
                                console.error("An error occurred: " + error);
                                $('#notificationDiv').text('An error occurred. Please try again.').removeClass('d-none');
                                $('#successMessage').addClass('d-none').text(''); 
                                $('#connectButton').hide(); 
                            }
                        });
                    } else {
                        $('#notificationDiv').addClass('d-none').text('');
                        $('#successMessage').addClass('d-none').text(''); 
                        $('#connectButton').hide();
                    }
                });
 
                $('#username').keyup(function () {
                    $('#notificationDiv').addClass('d-none').text(''); 
                    $('#successMessage').addClass('d-none').text(''); 
                    checkFormValidity();
                });
            });
</script>
    }
</body>
</html>